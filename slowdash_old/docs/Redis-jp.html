<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>SlowDash で Redis を使う</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="style.css" />
</head>

<body>

<header>
<div class="title">SlowDash で Redis を使う</div><p>
<div class="toc">
<span class="toc-title">Contents</span>
<nav id="TOC">
<ul>
<li><a href="#できること" id="toc-できること">できること</a></li>
<li><a href="#インストール" id="toc-インストール">インストール</a>
<ul>
<li><a
href="#docker-を使う場合redis-と-slowdash-の一括インストールとテスト"
id="toc-docker-を使う場合redis-と-slowdash-の一括インストールとテスト">Docker
を使う場合：Redis と SlowDash の一括インストールとテスト</a></li>
<li><a href="#redis-bare-metal-インストール"
id="toc-redis-bare-metal-インストール">Redis, Bare-Metal
インストール</a></li>
<li><a href="#slowdash-bare-metal-インストール"
id="toc-slowdash-bare-metal-インストール">SlowDash, Bare-Metal
インストール</a></li>
</ul></li>
<li><a href="#使い方" id="toc-使い方">使い方</a>
<ul>
<li><a href="#プロジェクト設定"
id="toc-プロジェクト設定">プロジェクト設定</a></li>
<li><a href="#データ形式" id="toc-データ形式">データ形式</a></li>
</ul></li>
</ul>
</nav>
</div>
</header>

<h1 id="できること">できること</h1>
<ul>
<li>Redis TS の時系列データをプロット</li>
<li>普通の Key-Value に入っている Redis ハッシュ値
(<code>RunNumber:12,Lapse:34,Operator:me</code> みたいなデータ)
を表形式で表示</li>
<li>Key-Value に Redis JSON (または普通の JSON 文字列)
で入っているヒストグラムやグラフを描画</li>
<li>Redis TS と Redis JSON (または普通の JSON 文字列)
を組み合わせて作ったヒストグラムの時系列データに対して，時間範囲指定付きの描画</li>
</ul>
<h1 id="インストール">インストール</h1>
<h2
id="docker-を使う場合redis-と-slowdash-の一括インストールとテスト">Docker
を使う場合：Redis と SlowDash の一括インストールとテスト</h2>
<p><code>ExampleProjects/Test_Redis</code> に Redis Server と，SlowDash
と，テストデータ生成スクリプトが全て入った
<code>docker-compose.yaml</code> があるので，これを使う：</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode console"><code class="sourceCode highlightconsole"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">$ cd PATH/TO/SLOWDASH/ExampleProjects/Test_Redis</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">$ docker compose up</span></span></code></pre></div>
<p>システムが立ち上がったら，ブラウザで
<code>http://localhost:18881</code> にアクセス：</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode console"><code class="sourceCode highlightconsole"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">$ firefox http://localhost:18881</span></span></code></pre></div>
<p>ちなみに，<code>docker-compose.yaml</code> の中身はこんな感じ：</p>
<pre><code>version: &#39;3&#39;

services:
  redis_server:
    image: redis/redis-stack:7.2.0-v10
    restart: always
    ports:
      - &quot;6379:6379&quot;
      - &quot;8001:8001&quot;

  slowdash:
    image: slowdash
    volumes:
      - .:/project
    ports:
      - &quot;18881:18881&quot;
    environment:
      - DB_URL=redis://redis_server:6379/12

  testdata:
    image: slowdash
    command: python /slowdash/utils/generate-testdata.py --db-url=redis://redis_server:6379/12</code></pre>
<p>Redis Insight も入っているので，ブラウザで
<code>http://localhost:8001</code> にアクセスすれば Redis
のデータを見られる．</p>
<h2 id="redis-bare-metal-インストール">Redis, Bare-Metal
インストール</h2>
<ul>
<li>Redis のサイトに行って Redis-Stack のイントール方法に従う： <a
href="https://redis.io/docs/stack/get-started/install/linux/">https://redis.io/docs/stack/get-started/install/linux/</a></li>
</ul>
<h3 id="centos7-2023-年-6-月-6-日">CentOS7, 2023 年 6 月 6 日</h3>
<h4 id="redis-本体-redis-stack">Redis 本体 (Redis Stack)</h4>
<p>以下のファイルを <code>/etc/yum.repos.d/redis.repo</code> に作成</p>
<pre><code>[Redis]
name=Redis
baseurl=http://packages.redis.io/rpm/rhel7
enabled=1
gpgcheck=1</code></pre>
<p>以下のコマンドを実行</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode console"><code class="sourceCode highlightconsole"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">$ curl -fsSL https://packages.redis.io/gpg &gt; /tmp/redis.key</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">$ sudo rpm --import /tmp/redis.key</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">$ sudo yum install epel-release</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="kw">$ sudo yum install redis-stack-server</span></span></code></pre></div>
<p>インストール直後</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode console"><code class="sourceCode highlightconsole"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">$ sudo systemctl status redis-stack-server</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>● redis-stack-server.service - Redis stack server</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>   Loaded: loaded (/etc/systemd/system/redis-stack-server.service; disabled; vendor preset: disabled)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>   Active: inactive (dead)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>     Docs: https://redis.io/</span></code></pre></div>
<p>スタートさせてみる</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode console"><code class="sourceCode highlightconsole"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">$ sudo systemctl start redis-stack-server</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">$ sudo systemctl status redis-stack-server</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>● redis-stack-server.service - Redis stack server</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>   Loaded: loaded (/etc/systemd/system/redis-stack-server.service; disabled; vendor preset: disabled)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>   Active: active (running) since 火 2023-06-06 12:40:11 PDT; 3s ago</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>     Docs: https://redis.io/</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a> Main PID: 4099 (redis-server)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    Tasks: 14</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>   CGroup: /system.slice/redis-stack-server.service</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>           └─4099 /opt/redis-stack/bin/redis-server *:6379</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a> 6月 06 12:40:11 vs13centos7 redis-server[4099]: 4099:M 06 Jun 2023 12:40:11.578 * &lt;ReJSON&gt; version: 20007 git sha: e51b585 branch: HEAD</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a> 6月 06 12:40:11 vs13centos7 redis-server[4099]: 4099:M 06 Jun 2023 12:40:11.578 * &lt;ReJSON&gt; Exported RedisJSON_V1 API</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a> 6月 06 12:40:11 vs13centos7 redis-server[4099]: 4099:M 06 Jun 2023 12:40:11.578 * &lt;ReJSON&gt; Enabled diskless replication</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a> 6月 06 12:40:11 vs13centos7 redis-server[4099]: 4099:M 06 Jun 2023 12:40:11.578 * &lt;ReJSON&gt; Created new data type &#39;ReJSON-RL&#39;</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a> 6月 06 12:40:11 vs13centos7 redis-server[4099]: 4099:M 06 Jun 2023 12:40:11.578 * Module &#39;ReJSON&#39; loaded from /opt/redis-stack...son.so</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a> 6月 06 12:40:11 vs13centos7 redis-server[4099]: 4099:M 06 Jun 2023 12:40:11.578 * &lt;search&gt; Acquired RedisJSON_V1 API</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a> 6月 06 12:40:11 vs13centos7 redis-server[4099]: 4099:M 06 Jun 2023 12:40:11.578 * &lt;graph&gt; Acquired RedisJSON_V1 API</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a> 6月 06 12:40:11 vs13centos7 redis-server[4099]: 4099:M 06 Jun 2023 12:40:11.578 * Module &#39;bf&#39; loaded from /opt/redis-stack/lib...oom.so</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a> 6月 06 12:40:11 vs13centos7 redis-server[4099]: 4099:M 06 Jun 2023 12:40:11.579 * The AOF directory appendonlydir doesn&#39;t exist</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a> 6月 06 12:40:11 vs13centos7 redis-server[4099]: 4099:M 06 Jun 2023 12:40:11.579 * Ready to accept connections</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>Hint: Some lines were ellipsized, use -l to show in full.</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="kw">$ redis-server --version</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>Redis server v=6.9.241 sha=00000000:0 malloc=jemalloc-5.2.1 bits=64 build=79cf147c911caf62</span></code></pre></div>
<p>自動起動の設定</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode console"><code class="sourceCode highlightconsole"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">$ sudo systemctl enable redis-stack-server</span></span></code></pre></div>
<h4 id="python-ライブラリ">Python ライブラリ</h4>
<div class="sourceCode" id="cb9"><pre
class="sourceCode console"><code class="sourceCode highlightconsole"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">$ python3 --version</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>Python 3.6.8</span></code></pre></div>
<p>Redis-py のページ(<a
href="https://redis-py.readthedocs.io/en/stable/">https://redis-py.readthedocs.io/en/stable/</a>)には
Python 3.7+ と書いてあったけれど，CentOS7 の Python 3.6.8
でもいけた．</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode console"><code class="sourceCode highlightconsole"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">$ pip3 install redis</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>Collecting redis</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  Downloading https://files.pythonhosted.org/packages/d6/f6/19237b28c632935c7359bddf703395ba13bbd134fc5e2eb297c4c120398c/redis-4.3.6-py3-none-any.whl (248kB)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    100% |████████████████████████████████| 256kB 2.4MB/s </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>Collecting typing-extensions; python_version &lt; &quot;3.8&quot; (from redis)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  Downloading https://files.pythonhosted.org/packages/45/6b/44f7f8f1e110027cf88956b59f2fad776cca7e1704396d043f89effd3a0e/typing_extensions-4.1.1-py3-none-any.whl</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>Collecting importlib-metadata&gt;=1.0; python_version &lt; &quot;3.8&quot; (from redis)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  Downloading https://files.pythonhosted.org/packages/a0/a1/b153a0a4caf7a7e3f15c2cd56c7702e2cf3d89b1b359d1f1c5e59d68f4ce/importlib_metadata-4.8.3-py3-none-any.whl</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>Collecting packaging&gt;=20.4 (from redis)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  Downloading https://files.pythonhosted.org/packages/05/8e/8de486cbd03baba4deef4142bd643a3e7bbe954a784dc1bb17142572d127/packaging-21.3-py3-none-any.whl (40kB)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    100% |████████████████████████████████| 40kB 7.2MB/s </span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>Collecting async-timeout&gt;=4.0.2 (from redis)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  Downloading https://files.pythonhosted.org/packages/d6/c1/8991e7c5385b897b8c020cdaad718c5b087a6626d1d11a23e1ea87e325a7/async_timeout-4.0.2-py3-none-any.whl</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>Collecting zipp&gt;=0.5 (from importlib-metadata&gt;=1.0; python_version &lt; &quot;3.8&quot;-&gt;redis)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  Downloading https://files.pythonhosted.org/packages/bd/df/d4a4974a3e3957fd1c1fa3082366d7fff6e428ddb55f074bf64876f8e8ad/zipp-3.6.0-py3-none-any.whl</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>Collecting pyparsing!=3.0.5,&gt;=2.0.2 (from packaging&gt;=20.4-&gt;redis)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  Downloading https://files.pythonhosted.org/packages/6c/10/a7d0fa5baea8fe7b50f448ab742f26f52b80bfca85ac2be9d35cdd9a3246/pyparsing-3.0.9-py3-none-any.whl (98kB)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    100% |████████████████████████████████| 102kB 9.0MB/s </span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>Installing collected packages: typing-extensions, zipp, importlib-metadata, pyparsing, packaging, async-timeout, redis</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>Successfully installed async-timeout-4.0.2 importlib-metadata-4.8.3 packaging-21.3 pyparsing-3.0.9 redis-4.3.6 typing-extensions-4.1.1 zipp-3.6.0</span></code></pre></div>
<p>使ってみる</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode console"><code class="sourceCode highlightconsole"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">$ python3</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>Python 3.6.8 (default, Nov 16 2020, 16:55:22) </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>[GCC 4.8.5 20150623 (Red Hat 4.8.5-44)] on linux</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>&gt;&gt;&gt; import redis</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>&gt;&gt;&gt; r = redis.Redis()</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>&gt;&gt;&gt; r.ping()</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>True</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>&gt;&gt;&gt; </span></code></pre></div>
<h3 id="ubuntu-20.04-2023-年-6-月-6-日">Ubuntu 20.04, 2023 年 6 月 6
日</h3>
<h4 id="redis-本体-redis-stack-1">Redis 本体 (Redis Stack)</h4>
<div class="sourceCode" id="cb12"><pre
class="sourceCode console"><code class="sourceCode highlightconsole"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">$ curl -fsSL https://packages.redis.io/gpg | sudo gpg --dearmor -o /usr/share/keyrings/redis-archive-keyring.gpg</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">$ sudo chmod 644 /usr/share/keyrings/redis-archive-keyring.gpg</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="kw">$ echo &quot;deb [signed-by=/usr/share/keyrings/redis-archive-keyring.gpg] https://packages.redis.io/deb $(lsb_release -cs) main&quot; | sudo tee /etc/apt/sources.list.d/redis.list</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">$ sudo apt-get update</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="kw">$ sudo apt-get install redis-stack-server</span></span></code></pre></div>
<h4 id="python-ライブラリ-1">Python ライブラリ</h4>
<pre><code>$ pip3 install redis</code></pre>
<h2 id="slowdash-bare-metal-インストール">SlowDash, Bare-Metal
インストール</h2>
<h3 id="python-インストール">Python インストール</h3>
<ul>
<li>python3</li>
<li>pip3: pyyaml, numpy</li>
</ul>
<h3 id="slowdash-インストール">SlowDash インストール</h3>
<div class="sourceCode" id="cb14"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> git clone https://github.com/slowproj/slowdash.git <span class="at">--recurse-submodules</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cd slowdash</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> make</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> source bin/slowdash-bashrc      <span class="co"># 毎回やるか，`.bashrc`  に書く</span></span></code></pre></div>
<h3 id="動作確認">動作確認</h3>
<h4 id="テストデータの生成">テストデータの生成</h4>
<p><strong>以下のダミーデータ生成スクリプトは，既存の Redis
データがあるとその内容と干渉する可能性があります．すでにデータがある場合はこの手順をスキップして，手持ちのデータを使う方がいいです．</strong></p>
<p>SlowDash に入っている Python ライブラリ SlowPy を使う．SlowPy は
Python
パッケージだけれど，今回はインストールせずに使うので，環境変数を設定する．それをする
bash のスクリプトを <code>source</code> する：</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode console"><code class="sourceCode highlightconsole"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">$ source PATH/TO/SLOWDASH/bin/slowdash-bashrc</span></span></code></pre></div>
<p>これでダミーデータを生成するスクリプトが走るはず：</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode console"><code class="sourceCode highlightconsole"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">$ PATH/TO/SLOWDASH/utils/generate-testdata.py --db-url=redis://redis_server:6379/1</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>[{&#39;key&#39;: &#39;test_graph_01&#39;}, {&#39;key&#39;: &#39;test_histogram_01&#39;}]</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>[{&#39;key&#39;: &#39;ch00&#39;, &#39;totalSamples&#39;: 1, &#39;firstTimeStamp&#39;: None, &#39;lastTimeStamp&#39;: None, &#39;retentionTime&#39;: 3600000}, {&#39;key&#39;: &#39;ch10&#39;, &#39;totalSamples&#39;: 1, &#39;firstTimeStamp&#39;: None, &#39;lastTimeStamp&#39;: None, &#39;retentionTime&#39;: 3600000}, {&#39;key&#39;: &#39;ch14&#39;, &#39;totalSamples&#39;: 1, &#39;firstTimeStamp&#39;: None, &#39;lastTimeStamp&#39;: None, &#39;retentionTime&#39;: 3600000}, {&#39;key&#39;: &#39;ch04&#39;, &#39;totalSamples&#39;: 1, &#39;firstTimeStamp&#39;: None, &#39;lastTimeStamp&#39;: None, &#39;retentionTime&#39;: 3600000}, {&#39;key&#39;: &#39;ch15&#39;, &#39;totalSamples&#39;: 1, &#39;firstTimeStamp&#39;: None, &#39;lastTimeStamp&#39;: None, &#39;retentionTime&#39;: 3600000}, {&#39;key&#39;: &#39;ch03&#39;, &#39;totalSamples&#39;: 1, &#39;firstTimeStamp&#39;: None, &#39;lastTimeStamp&#39;: None, &#39;retentionTime&#39;: 3600000}, {&#39;key&#39;: &#39;ch11&#39;, &#39;totalSamples&#39;: 1, &#39;firstTimeStamp&#39;: None, &#39;lastTimeStamp&#39;: None, &#39;retentionTime&#39;: 3600000}, {&#39;key&#39;: &#39;ch02&#39;, &#39;totalSamples&#39;: 1, &#39;firstTimeStamp&#39;: None, &#39;lastTimeStamp&#39;: None, &#39;retentionTime&#39;: 3600000}, {&#39;key&#39;: &#39;ch09&#39;, &#39;totalSamples&#39;: 1, &#39;firstTimeStamp&#39;: None, &#39;lastTimeStamp&#39;: None, &#39;retentionTime&#39;: 3600000}, {&#39;key&#39;: &#39;ch08&#39;, &#39;totalSamples&#39;: 1, &#39;firstTimeStamp&#39;: None, &#39;lastTimeStamp&#39;: None, &#39;retentionTime&#39;: 3600000}, {&#39;key&#39;: &#39;ch13&#39;, &#39;totalSamples&#39;: 1, &#39;firstTimeStamp&#39;: None, &#39;lastTimeStamp&#39;: None, &#39;retentionTime&#39;: 3600000}, {&#39;key&#39;: &#39;ch05&#39;, &#39;totalSamples&#39;: 1, &#39;firstTimeStamp&#39;: None, &#39;lastTimeStamp&#39;: None, &#39;retentionTime&#39;: 3600000}, {&#39;key&#39;: &#39;ch06&#39;, &#39;totalSamples&#39;: 1, &#39;firstTimeStamp&#39;: None, &#39;lastTimeStamp&#39;: None, &#39;retentionTime&#39;: 3600000}, {&#39;key&#39;: &#39;ch01&#39;, &#39;totalSamples&#39;: 1, &#39;firstTimeStamp&#39;: None, &#39;lastTimeStamp&#39;: None, &#39;retentionTime&#39;: 3600000}, {&#39;key&#39;: &#39;ch07&#39;, &#39;totalSamples&#39;: 1, &#39;firstTimeStamp&#39;: None, &#39;lastTimeStamp&#39;: None, &#39;retentionTime&#39;: 3600000}, {&#39;key&#39;: &#39;ch12&#39;, &#39;totalSamples&#39;: 1, &#39;firstTimeStamp&#39;: None, &#39;lastTimeStamp&#39;: None, &#39;retentionTime&#39;: 3600000}]</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>[{&#39;key&#39;: &#39;test_graph_02&#39;, &#39;totalSamples&#39;: 1, &#39;firstTimeStamp&#39;: None, &#39;lastTimeStamp&#39;: None, &#39;retentionTime&#39;: 3600000}, {&#39;key&#39;: &#39;test_histogram_02&#39;, &#39;totalSamples&#39;: 1, &#39;firstTimeStamp&#39;: None, &#39;lastTimeStamp&#39;: None, &#39;retentionTime&#39;: 3600000}]</span></code></pre></div>
<h4 id="slowdash-の実行テスト">SlowDash の実行テスト</h4>
<p>上記データ生成コマンドを走らせたまま別ウィンドウで SlowDash
を走らせる：</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode console"><code class="sourceCode highlightconsole"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">$ cd PATH/TO/SLOWDASH/ExampleProjects/Test_Redis</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">$ slowdash channels</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>[{&quot;name&quot;: &quot;Status&quot;, &quot;type&quot;: &quot;tree&quot;}, {&quot;name&quot;: &quot;test_graph_01&quot;, &quot;type&quot;: &quot;graph&quot;}, {&quot;name&quot;: &quot;test_histogram_01&quot;, &quot;type&quot;: &quot;histogram&quot;}, {&quot;name&quot;: &quot;ch00&quot;, &quot;type&quot;: &quot;timeseries&quot;}, {&quot;name&quot;: &quot;ch10&quot;, &quot;type&quot;: &quot;timeseries&quot;}, {&quot;name&quot;: &quot;ch14&quot;, &quot;type&quot;: &quot;timeseries&quot;}, {&quot;name&quot;: &quot;ch04&quot;, &quot;type&quot;: &quot;timeseries&quot;}, {&quot;name&quot;: &quot;ch15&quot;, &quot;type&quot;: &quot;timeseries&quot;}, {&quot;name&quot;: &quot;ch03&quot;, &quot;type&quot;: &quot;timeseries&quot;}, {&quot;name&quot;: &quot;ch11&quot;, &quot;type&quot;: &quot;timeseries&quot;}, {&quot;name&quot;: &quot;ch02&quot;, &quot;type&quot;: &quot;timeseries&quot;}, {&quot;name&quot;: &quot;ch09&quot;, &quot;type&quot;: &quot;timeseries&quot;}, {&quot;name&quot;: &quot;ch08&quot;, &quot;type&quot;: &quot;timeseries&quot;}, {&quot;name&quot;: &quot;ch13&quot;, &quot;type&quot;: &quot;timeseries&quot;}, {&quot;name&quot;: &quot;ch05&quot;, &quot;type&quot;: &quot;timeseries&quot;}, {&quot;name&quot;: &quot;ch06&quot;, &quot;type&quot;: &quot;timeseries&quot;}, {&quot;name&quot;: &quot;ch01&quot;, &quot;type&quot;: &quot;timeseries&quot;}, {&quot;name&quot;: &quot;ch07&quot;, &quot;type&quot;: &quot;timeseries&quot;}, {&quot;name&quot;: &quot;ch12&quot;, &quot;type&quot;: &quot;timeseries&quot;}]</span></code></pre></div>
<p>ちゃんとデータが見えているので，ポート番号を指定して SlowDash
を走らせる：</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode console"><code class="sourceCode highlightconsole"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">$ slowdash --port=18881</span></span></code></pre></div>
<p>ブラウザで <code>http://localhost:18881/</code> に接続．</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode console"><code class="sourceCode highlightconsole"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">$ firefox http://localhost:18881/</span></span></code></pre></div>
<p><img src="fig/Redis-Home.png" width="80%" style="margin:2rem;box-shadow: 0px 0px 15px -5px rgba(0,0,0,0.7);"></p>
左下の Channel List にチャンネルが表示されていることを確認．
<p>
<p>右上の Slow-Plot にある <code>redis-test</code>
をクリックしてデータパネルを表示する：
<img src="fig/Redis-SimplePlots.png" width="80%" style="margin:2rem;box-shadow: 0px 0px 15px -5px rgba(0,0,0,0.7);"></p>
<h1 id="使い方">使い方</h1>
<h2 id="プロジェクト設定">プロジェクト設定</h2>
<p>動作テストに使った <code>ExampleProjects/Test_Redis</code> の
<code>SlowdashProject.yaml</code> にあるように，Redis
サーバのアドレス，ポート番号とデータベース番号を指定するだけで良い．</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slowdash_project</span><span class="kw">:</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">data_source</span><span class="kw">:</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">url</span><span class="kw">:</span><span class="at"> redis://localhost:6379/1</span></span></code></pre></div>
<p>複数のデータベース番号を使いたいときは，<code>data_source</code>
を配列にできる．ただし，これは省略形式で，正式には，以下のようにデータ形式ごとにエントリを作る．こうするとよりきめ細かくパラメータを設定できる．</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slowdash_project</span><span class="kw">:</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> RedisTest</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">title</span><span class="kw">:</span><span class="at"> Redis Test, Simple version</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">data_source</span><span class="kw">:</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> Redis</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">parameters</span><span class="kw">:</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">url</span><span class="kw">:</span><span class="at"> redis://localhost:6379/</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">hash</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span><span class="at"> </span><span class="fu">db</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span><span class="at"> </span><span class="kw">}</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">time_series</span><span class="kw">:</span><span class="at"> </span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">db</span><span class="kw">:</span><span class="at"> </span><span class="dv">2</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">db</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">suffix</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;.second_TS&#39;</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">object</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span><span class="at"> </span><span class="fu">db</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span><span class="at"> </span><span class="kw">}</span></span></code></pre></div>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>エントリ名</th>
<th>データ</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>hash</code></td>
<td>Redis ハッシュ値が SlowDash の Tree として読まれる</td>
</tr>
<tr class="even">
<td><code>time_series</code></td>
<td>Redis TS 値が SlowDash の TimeSeries として読まれる</td>
</tr>
<tr class="odd">
<td><code>object</code></td>
<td>Redis JSON 値が SlowDash の Histogram / Graph / etc.
として読まれる</td>
</tr>
<tr class="even">
<td><code>object_time_series</code></td>
<td>Redis TS と Redis JSON を組み合わせた SlowDash
形式でオブジェクトの時系列が格納されている場合</td>
</tr>
</tbody>
</table>
<p>複数のデーターベース間でキーの重複がある場合は，<code>suffix</code>
パラメータを指定すると，SlowDash
チャンネル名にサフィックスが付いて区別できる．</p>
<h2 id="データ形式">データ形式</h2>
<h3 id="時系列データ">時系列データ</h3>
<p>Redis TimeSeries
で記録したデータは自動で検出され，チャンネルリストに表示される．</p>
<h3 id="ハッシュ値">ハッシュ値</h3>
<p>Redis の通常の Key-Value でハッシュ値を記録した場合，SlowDash の Tree
型として取り込まれる．動作テスト例の左上のパネル．</p>
<h3
id="ヒストグラムとグラフ-最新値のみ保持の簡単な場合">ヒストグラムとグラフ
(最新値のみ保持の簡単な場合)</h3>
<p>Redis JSON を使って特定の構造の JSON オブジェクトを記録すると
SlowDash にヒストグラムやグラフとして認識される．</p>
<p>Python のコードはこんな感じ：</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> redis</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> redis.Redis(<span class="st">&#39;localhost&#39;</span>, <span class="dv">6379</span>, <span class="dv">1</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>hist <span class="op">=</span> {</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;bins&#39;</span>: { <span class="st">&#39;min&#39;</span>: <span class="dv">0</span>, <span class="st">&#39;max&#39;</span>: <span class="dv">100</span> },</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;counts&#39;</span>: [ <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">14</span>, <span class="dv">11</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">1</span> ]</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>r.json().<span class="bu">set</span>(<span class="st">&#39;hist00&#39;</span>, <span class="st">&#39;$&#39;</span>, hist)</span></code></pre></div>
<p>あるいは，普通の Key-Value に，JSON 文字列で保存しても良い (C++
とかからならこちらの方が便利かも)：</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> redis</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> redis.Redis(<span class="st">&#39;localhost&#39;</span>, <span class="dv">6379</span>, <span class="dv">1</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>hist <span class="op">=</span> <span class="st">&#39;&#39;&#39;{</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="st">  &quot;bins&quot;: { &quot;min&quot;: 0, &quot;max&quot;: 100 },</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="st">  &quot;counts&quot;: [ 3, 5, 8, 14, 11, 3, 6, 4, 4, 1 ]</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="st">}&#39;&#39;&#39;</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>r.<span class="bu">set</span>(<span class="st">&#39;hist00&#39;</span>, hist)</span></code></pre></div>
<p>JSON のデータ構造は以下の通り：</p>
<h5 id="ヒストグラム">ヒストグラム</h5>
<div class="sourceCode" id="cb24"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;bins&quot;</span><span class="fu">:</span> <span class="fu">{</span><span class="dt">&quot;min&quot;</span><span class="fu">:</span> <span class="er">MIN</span><span class="fu">,</span> <span class="dt">&quot;max&quot;</span><span class="fu">:</span> <span class="er">MAX</span><span class="fu">},</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;counts&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="er">C0</span><span class="ot">,</span> <span class="er">C1</span><span class="ot">,</span> <span class="er">C2</span><span class="ot">,</span> <span class="er">...</span><span class="ot">]</span> </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<ul>
<li><code>counts</code> があることにより，この JSON
がヒストグラムだと判別される．</li>
<li>ビンは現在のところ等間隔のみ．ビン数は <code>counts</code>
配列の長さで決められる．</li>
</ul>
<h5 id="グラフ">グラフ</h5>
<div class="sourceCode" id="cb25"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;labels&quot;</span><span class="fu">:</span> <span class="ot">[</span> <span class="er">XLABEL</span><span class="ot">,</span> <span class="er">YLABEL</span> <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;x&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="er">x0</span><span class="ot">,</span> <span class="er">x1</span><span class="ot">,</span> <span class="er">x2</span><span class="ot">,</span> <span class="er">...</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;y&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="er">y0</span><span class="ot">,</span> <span class="er">y1</span><span class="ot">,</span> <span class="er">y2</span><span class="ot">,</span> <span class="er">...</span><span class="ot">]</span><span class="fu">,</span>    </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<ul>
<li><code>y</code> があることにより，この JSON
がグラフだと判別される．</li>
</ul>
<h5 id="それ以外">それ以外</h5>
<p><a href="DataModel.html#value-types-and-json-representation">Data
Model</a> を参照．</p>
<h3 id="ヒストグラムやグラフの時系列">ヒストグラムやグラフの時系列</h3>
<p>Redis TimeSeries と Redis JSON
を組み合わせて実現されている．構造が面倒なので，SlowPy
ライブラリを使うのが便利だと思う．</p>
<p>こんな感じ：</p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> slowpy <span class="im">import</span> Histogram</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> slowpy.store <span class="im">import</span> DataStore_Redis</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>datastore <span class="op">=</span> DataStore_Redis(<span class="st">&#39;redis://localhost/2&#39;</span>, retention_length<span class="op">=</span><span class="dv">3600</span>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>histogram <span class="op">=</span> Histogram(nbins<span class="op">=</span><span class="dv">20</span>, range_min<span class="op">=-</span><span class="dv">10</span>, range_max<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">100</span>):</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>        h.fill(np.random.normal(<span class="dv">5</span>, <span class="dv">2</span>))</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># これ</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>    datastore.append(histogram, tag<span class="op">=</span><span class="st">&#39;test_histogram_01&#39;</span>)</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="dv">1</span>)</span></code></pre></div>
<p>ヒストグラムやグラフの時系列データは大量のキーバリューを作るので、専用のデータベースを使用した方が良い．この例ではデータベース番号
2 を使用している．</p>
<p>ちなみに，<code>append()</code> の代わりに <code>update()</code>
とすると，時刻情報なしで最新版だけを同じキーで保存するようになる（上記の例）．</p>


</body>
</html>
